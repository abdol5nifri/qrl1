<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ”³ ØªÙˆÙ„ÙŠØ¯ QR Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qr-code-styling/lib/qr-code-styling.js"></script>
    <style>
      /* Ù‡Ø§Ø¯ Ø§Ù„Ù€CSS Ù‡Ùˆ Ø§Ù„Ù„ÙŠ ØºÙŠØ®Ù„ÙŠ Ø§Ù„Ù€QR ÙŠØ¨Ø§Ù† Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© ÙØ§Ù„Ø´Ø§Ø´Ø© */
      #qr canvas {
        width: 100% !important; /* ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù€canvas ÙƒÙŠØ¹Ù…Ø± Ø§Ù„Ù€div Ø¯ÙŠØ§Ù„Ùˆ ÙƒØ§Ù…Ù„ */
        height: 100% !important; /* ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù€canvas ÙƒÙŠØ¹Ù…Ø± Ø§Ù„Ù€div Ø¯ÙŠØ§Ù„Ùˆ ÙƒØ§Ù…Ù„ */
        /* Ù‡Ø§Ø¯ Ø§Ù„Ø®Ø§ØµÙŠØ§Øª ÙƒÙŠØ­Ø³Ù‘Ù†Ùˆ Ø¬ÙˆØ¯Ø© Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù„ÙŠ ÙƒØªØµØºØ± Ø£Ùˆ ØªÙƒØ¨Ø± */
        image-rendering: crisp-edges; /* Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© */
        image-rendering: -moz-crisp-edges; /* Ù„Ù…ØªØµÙØ­ ÙØ§ÙŠØ±ÙÙˆÙƒØ³ */
        image-rendering: -webkit-optimize-contrast; /* Ù„Ù…ØªØµÙØ­Ø§Øª ÙƒØ±ÙˆÙ… ÙˆØ³ÙØ§Ø±ÙŠ */
        image-rendering: optimizeSpeed; /* Ù„Ù…ØªØµÙØ­Ø§Øª Ù‚Ø¯ÙŠÙ…Ø©ØŒ ÙƒØªØ¹Ø§ÙˆÙ† Ø¨Ø§Ø´ Ø§Ù„ØµÙˆØ±Ø© ØªØ¨Ø§Ù† Ø­Ø§Ø¯Ø© */
      }
      /* Ø³ØªØ§ÙŠÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù…Ù…ÙƒÙ† ØªØ¹Ø¯Ù„Ù‡Ù… Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©) */
      .input-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 1rem;
      }
      .input-group label {
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #333; /* Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø¯ÙŠØ§Ù„ Ø§Ù„Ù€label */
      }
      .input-group input,
      .input-group select {
        border: 1px solid #e2e8f0; /* Ù„ÙˆÙ† Border */
        border-radius: 0.375rem; /* Roundness */
        padding: 0.5rem;
        font-size: 1rem;
      }
      .input-group input::file-selector-button {
        background-color: #e2e8f0;
        border: none;
        border-radius: 0.375rem;
        padding: 0.5rem 1rem;
        cursor: pointer;
        transition: background-color 0.2s ease-in-out;
      }
      .input-group input::file-selector-button:hover {
        background-color: #cbd5e1;
      }
      .button-group {
        display: flex;
        flex-direction: column;
        gap: 0.75rem; /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        margin-top: 1.5rem;
      }
      .button-group button {
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: background-color 0.2s ease-in-out;
      }
      .qr-display-area {
        display: flex;
        flex-direction: column; /* Ø¨Ø§Ø´ Ø§Ù„Ù€QR ÙˆØ§Ù„Ù†Øµ ÙŠÙƒÙˆÙ†Ùˆ ÙˆØ§Ø­Ø¯ ØªØ­Øª ÙˆØ§Ø­Ø¯ */
        justify-content: center;
        align-items: center;
        padding-top: 1rem;
        padding-bottom: 1rem;
        min-height: 250px; /* Ø²Ø¯Ù†Ø§ Ø§Ù„Ø·ÙˆÙ„ Ø´ÙˆÙŠØ© Ø¨Ø§Ø´ ÙŠÙƒÙˆÙ† Ø¨Ù„Ø§ØµØ© Ù„Ù„Ù†Øµ */
      }
      .qr-text-below {
        margin-top: 1rem; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ù€QR ÙˆØ§Ù„Ù†Øµ */
        font-size: 1.5rem; /* Ø­Ø¬Ù… Ø§Ù„Ø®Ø· Ø¯ÙŠØ§Ù„ Ø§Ù„Ù†Øµ */
        font-weight: bold;
        color: #333;
      }
      /* Ø³ØªØ§ÙŠÙ„Ø§Øª Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† */
      .color-swatch {
        width: 32px; /* Ø­Ø¬Ù… Ø§Ù„Ù…Ø±Ø¨Ø¹ */
        height: 32px; /* Ø­Ø¬Ù… Ø§Ù„Ù…Ø±Ø¨Ø¹ */
        border-radius: 50%; /* Ø¨Ø§Ø´ ÙŠÙƒÙˆÙ† Ø¯Ø§Ø¦Ø±ÙŠ */
        cursor: pointer;
        border: 2px solid #e2e8f0; /* Ø¥Ø·Ø§Ø± Ø±Ù…Ø§Ø¯ÙŠ Ø®ÙÙŠÙ */
        transition: border-color 0.2s ease-in-out, transform 0.2s ease-in-out;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1); /* Ø¸Ù„ Ø®ÙÙŠÙ */
      }
      .color-swatch:hover {
        border-color: #3b82f6; /* Ø¥Ø·Ø§Ø± Ø£Ø²Ø±Ù‚ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
        transform: scale(1.1); /* ØªÙƒØ¨ÙŠØ± Ø¨Ø³ÙŠØ· Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
      }
      .color-swatch.selected {
        border-color: #10B981; /* Ø¥Ø·Ø§Ø± Ø£Ø®Ø¶Ø± Ù…Ù„ÙŠ ÙƒÙŠÙƒÙˆÙ† Ù…Ø®ØªØ§Ø± */
        box-shadow: 0 0 0 3px rgba(16,185,129,0.5); /* Ø¸Ù„ Ø£Ø®Ø¶Ø± Ø¥Ø¶Ø§ÙÙŠ */
        transform: scale(1.1);
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white shadow-xl rounded-xl p-6 w-full max-w-md">
      <h1 class="text-3xl font-extrabold mb-6 text-center text-gray-800">ğŸ”³ ØªÙˆÙ„ÙŠØ¯ QR Ø§Ø­ØªØ±Ø§ÙÙŠ</h1>

      <div class="input-group">
        <label for="text">ğŸ”— Ø§Ù„Ù†Øµ Ø£Ùˆ Ø§Ù„Ø±Ø§Ø¨Ø·:</label>
        <input id="text" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ù‡Ù†Ø§..." />
      </div>

      <div class="input-group">
        <label class="block mb-2 font-semibold">ğŸ¨ Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†:</label>
        <div id="color-palette" class="flex gap-3 mb-4 flex-wrap">
          <div class="color-swatch" style="background-color: #000000;" data-color="#000000"></div>
          <div class="color-swatch" style="background-color: #0000FF;" data-color="#0000FF"></div>
          <div class="color-swatch" style="background-color: #FF0000;" data-color="#FF0000"></div>
          <div class="color-swatch" style="background-color: #008000;" data-color="#008000"></div>
          <div class="color-swatch" style="background-color: #800080;" data-color="#800080"></div> <div class="color-swatch" style="background-color: #FFA500;" data-color="#FFA500"></div> </div>
      </div>
      <div class="input-group">
        <label for="style">ğŸ”˜ Ø§Ù„Ø´ÙƒÙ„:</label>
        <select id="style">
          <option value="square">Ù…Ø±Ø¨Ø¹Ø§Øª</option>
          <option value="dots">Ù†Ù‚Ø·</option>
          <option value="rounded">Ø¯Ø§Ø¦Ø±ÙŠ</option>
        </select>
      </div>

      <div class="input-group">
        <label for="logo">ğŸ–¼ï¸ Ø´Ø¹Ø§Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
        <input id="logo" type="file" accept="image/*" />
      </div>
      
      <div class="input-group">
        <label for="bottomText">ğŸ“ Ù†Øµ ØªØ­Øª Ø§Ù„Ù€QR (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
        <input id="bottomText" type="text" placeholder="Ù…Ø«Ø§Ù„: VITORHOP" />
      </div>

      <div class="qr-display-area">
        <div id="qr" class="w-[200px] h-[200px] overflow-hidden"></div>
        <div id="text-below-qr" class="qr-text-below"></div>
      </div>

      <div class="button-group">
        <button id="download" class="bg-green-500 text-white hover:bg-green-600">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ QR</button>
        <button id="share" class="bg-blue-500 text-white hover:bg-blue-600">ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© QR</button>
      </div>
    </div>

    <script>
      const initialText = document.getElementById("text").value;
      const initialBottomText = document.getElementById("bottomText").value;
      let currentQRColor = "#000000"; // Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø£ÙˆÙ„ Ù„ÙˆÙ† ØºÙŠØ¨Ø§Ù†)

      const qrCode = new QRCodeStyling({
        width: 1000,
        height: 1000,
        type: "canvas",
        data: initialText,
        image: "",
        dotsOptions: {
          color: currentQRColor, // ØºÙŠØ³ØªØ¹Ù…Ù„ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø§Ù„Ù„ÙŠ Ø¯Ø±Ù†Ø§Ù‡
          type: "square",
        },
        backgroundOptions: {
          color: "#FFFF00", // Ù„ÙˆÙ† Ø£ØµÙØ± Ù„Ù„Ø®Ù„ÙÙŠØ© (Ø«Ø§Ø¨Øª)
        },
        imageOptions: {
          crossOrigin: "anonymous",
          margin: 20,
        },
        margin: 30, // Ø§Ù„Ù‡Ø§Ù…Ø´ Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø­ÙˆÙ„ Ø§Ù„Ù€QR Code Ù†ÙØ³Ù‡
      });

      qrCode.append(document.getElementById("qr"));

      function updateBottomText() {
        document.getElementById("text-below-qr").innerText = document.getElementById("bottomText").value;
      }

      function updateQRCode() {
        const text = document.getElementById("text").value;
        const shape = document.getElementById("style").value;

        qrCode.update({
          data: text,
          dotsOptions: {
            color: currentQRColor, // ØºÙŠØ³ØªØ¹Ù…Ù„ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…Ø®ØªØ§Ø± Ø­Ø§Ù„ÙŠØ§Ù‹
            type: shape,
          },
          backgroundOptions: {
             color: "#FFFF00", // Ø¨Ø§Ø´ ØªØ¨Ù‚Ù‰ Ø¯ÙŠÙ…Ø§ ØµÙØ±Ø§Ø¡
          },
        });
        updateBottomText();
      }

      // ØªØ­Ø¯ÙŠØ¯ Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…Ø®ØªØ§Ø± Ø­Ø§Ù„ÙŠØ§Ù‹
      function setActiveColorSwatch(selectedColor) {
        document.querySelectorAll('.color-swatch').forEach(swatch => {
          if (swatch.dataset.color === selectedColor) {
            swatch.classList.add('selected');
          } else {
            swatch.classList.remove('selected');
          }
        });
      }

      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„Ù„Ø£Ø­Ø¯Ø§Ø«
      document.getElementById("text").addEventListener("input", updateQRCode);
      document.getElementById("style").addEventListener("change", updateQRCode);
      document.getElementById("bottomText").addEventListener("input", updateQRCode);

      // Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ø§Ù„Ø¬Ø¯Ø¯ Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù†
      document.querySelectorAll(".color-swatch").forEach(swatch => {
        swatch.addEventListener("click", function() {
          currentQRColor = this.dataset.color; // Ø®Ø¯ÙŠÙ†Ø§ Ø§Ù„Ù„ÙˆÙ† Ù…Ù† data-color
          setActiveColorSwatch(currentQRColor); // ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…Ø®ØªØ§Ø±
          updateQRCode(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€QR Code Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø¬Ø¯ÙŠØ¯
        });
      });

      document.getElementById("logo").addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (!file) {
            qrCode.update({ image: "" });
            return;
        }
        const reader = new FileReader();
        reader.onload = function (event) {
          qrCode.update({ image: event.target.result });
        };
        reader.readAsDataURL(file);
      });

      document.getElementById("download").addEventListener("click", () => {
        const qrCanvas = document.querySelector("#qr canvas");
        const bottomTextValue = document.getElementById("bottomText").value;

        if (!bottomTextValue.trim()) {
          qrCode.download({ name: "qr-code", extension: "png" });
          return;
        }

        const combinedCanvas = document.createElement("canvas");
        const ctx = combinedCanvas.getContext("2d");

        const qrWidth = qrCanvas.width;
        const qrHeight = qrCanvas.height;

        const fontSize = 70; 
        const font = `bold ${fontSize}px Arial`;
        const textPadding = 40; 

        const bottomMarginForImage = 50; 

        combinedCanvas.width = qrWidth;
        combinedCanvas.height = qrHeight + fontSize + textPadding + bottomMarginForImage; 

        ctx.drawImage(qrCanvas, 0, 0);

        ctx.fillStyle = '#FFFFFF'; 
        ctx.fillRect(0, qrHeight, combinedCanvas.width, combinedCanvas.height - qrHeight);

        ctx.font = font;
        ctx.fillStyle = '#000000';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';

        const textX = combinedCanvas.width / 2;
        const textY = qrHeight + textPadding;

        ctx.fillText(bottomTextValue, textX, textY);

        const link = document.createElement('a');
        link.download = 'qr-code-with-text.png';
        link.href = combinedCanvas.toDataURL('image/png');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      });

      document.getElementById("share").addEventListener("click", async () => {
        const canvas = document.querySelector("#qr canvas");
        canvas.toBlob(async (blob) => {
          const file = new File([blob], "qr-code.png", { type: "image/png" });
          if (navigator.canShare && navigator.canShare({ files: [file] })) {
            try {
              await navigator.share({ files: [file], title: "QR Code", text: "Ù‡Ø§ Ù‡Ùˆ ÙƒÙˆØ¯ QR Ø¯ÙŠØ§Ù„Ùƒ!" });
            } catch (e) {
              alert("ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©");
            }
          } else {
            alert("Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø².");
          }
        });
      });

      // ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Øµ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø§Ù„Ù…Ø®ØªØ§Ø±
      updateBottomText();
      setActiveColorSwatch(currentQRColor); // ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
      updateQRCode(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€QR Code Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    </script>
  </body>
</html>
