<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>๐ณ ุชูููุฏ QR ุงุญุชุฑุงูู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qr-code-styling/lib/qr-code-styling.js"></script>
    <style>
      /* ูุงุฏ ุงููCSS ูู ุงููู ุบูุฎูู ุงููQR ูุจุงู ุจุฏูุฉ ุนุงููุฉ ูุงูุดุงุดุฉ */
      #qr canvas {
        width: 100% !important; /* ุชุฃูุฏ ูู ุฃู ุงููcanvas ููุนูุฑ ุงููdiv ุฏูุงูู ูุงูู */
        height: 100% !important; /* ุชุฃูุฏ ูู ุฃู ุงููcanvas ููุนูุฑ ุงููdiv ุฏูุงูู ูุงูู */
        /* ูุงุฏ ุงูุฎุงุตูุงุช ููุญุณููู ุฌูุฏุฉ ุนุฑุถ ุงูุตูุฑุฉ ููู ูุชุตุบุฑ ุฃู ุชูุจุฑ */
        image-rendering: crisp-edges; /* ูููุชุตูุญุงุช ุงูุญุฏูุซุฉ */
        image-rendering: -moz-crisp-edges; /* ููุชุตูุญ ูุงูุฑูููุณ */
        image-rendering: -webkit-optimize-contrast; /* ููุชุตูุญุงุช ูุฑูู ูุณูุงุฑู */
        image-rendering: optimizeSpeed; /* ููุชุตูุญุงุช ูุฏููุฉุ ูุชุนุงูู ุจุงุด ุงูุตูุฑุฉ ุชุจุงู ุญุงุฏุฉ */
      }
      /* ุณุชุงููุงุช ุฅุถุงููุฉ ููุชุตููู ุงูุฌุฏูุฏ (ูููู ุชุนุฏููู ุญุณุจ ุงูุญุงุฌุฉ) */
      .input-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 1rem;
      }
      .input-group label {
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #333; /* ููู ุงููุต ุฏูุงู ุงููlabel */
      }
      .input-group input,
      .input-group select {
        border: 1px solid #e2e8f0; /* ููู Border */
        border-radius: 0.375rem; /* Roundness */
        padding: 0.5rem;
        font-size: 1rem;
      }
      .input-group input::file-selector-button {
        background-color: #e2e8f0;
        border: none;
        border-radius: 0.375rem;
        padding: 0.5rem 1rem;
        cursor: pointer;
        transition: background-color 0.2s ease-in-out;
      }
      .input-group input::file-selector-button:hover {
        background-color: #cbd5e1;
      }
      .button-group {
        display: flex;
        flex-direction: column;
        gap: 0.75rem; /* ุงููุณุงูุฉ ุจูู ุงูุฃุฒุฑุงุฑ */
        margin-top: 1.5rem;
      }
      .button-group button {
        padding: 0.75rem 1.5rem;
        border-radius: 0.5rem;
        font-weight: 600;
        transition: background-color 0.2s ease-in-out;
      }
      .qr-display-area {
        display: flex;
        flex-direction: column; /* ุจุงุด ุงููQR ูุงููุต ููููู ูุงุญุฏ ุชุญุช ูุงุญุฏ */
        justify-content: center;
        align-items: center;
        padding-top: 1rem;
        padding-bottom: 1rem;
        min-height: 250px; /* ุฒุฏูุง ุงูุทูู ุดููุฉ ุจุงุด ูููู ุจูุงุตุฉ ูููุต */
        border: 2px dashed #a0aec0; /* ุฅุทุงุฑ ูุชูุทุน ุจุงุด ูุจุงู ูุฃูู placeholder */
        border-radius: 1rem;
        color: #a0aec0; /* ููู ุงููุต ุฏุงุฎู ุงููplaceholder */
        font-size: 1.2rem;
        text-align: center;
      }
      #qr {
          /* #qr ูู ุงูุจุฏุงูุฉ ูุชููู ูุฎููุฉ ุฃู ุนูุฏูุง ุญุฌู ุตุบูุฑ */
          width: 0px; 
          height: 0px;
          overflow: hidden;
          transition: width 0.3s ease, height 0.3s ease; /* ุจุงุด ุชุจุงู ุจุงูุณูุงุจูุฉ */
      }
      #qr.active {
          width: 200px; /* ุงูุญุฌู ุงููู ุจุงุบู ูููQR ููู ููุจุงู */
          height: 200px;
          background-color: #FFFF00; /* ุฎูููุฉ ุงููQR Code ููุณู */
          border-radius: 0.5rem;
          overflow: hidden;
      }
      .qr-text-below {
        margin-top: 1rem; /* ูุณุงูุฉ ุจูู ุงููQR ูุงููุต */
        font-size: 1.5rem; /* ุญุฌู ุงูุฎุท ุฏูุงู ุงููุต */
        font-weight: bold;
        color: #333;
      }
      /* ุณุชุงููุงุช ููุฑุจุนุงุช ุงูุฃููุงู */
      .color-swatch {
        width: 32px; /* ุญุฌู ุงููุฑุจุน */
        height: 32px; /* ุญุฌู ุงููุฑุจุน */
        border-radius: 50%; /* ุจุงุด ูููู ุฏุงุฆุฑู */
        cursor: pointer;
        border: 2px solid #e2e8f0; /* ุฅุทุงุฑ ุฑูุงุฏู ุฎููู */
        transition: border-color 0.2s ease-in-out, transform 0.2s ease-in-out;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1); /* ุธู ุฎููู */
      }
      .color-swatch:hover {
        border-color: #3b82f6; /* ุฅุทุงุฑ ุฃุฒุฑู ุนูุฏ ุงูุชุญููู */
        transform: scale(1.1); /* ุชูุจูุฑ ุจุณูุท ุนูุฏ ุงูุชุญููู */
      }
      .color-swatch.selected {
        border-color: #10B981; /* ุฅุทุงุฑ ุฃุฎุถุฑ ููู ููููู ูุฎุชุงุฑ */
        box-shadow: 0 0 0 3px rgba(16,185,129,0.5); /* ุธู ุฃุฎุถุฑ ุฅุถุงูู */
        transform: scale(1.1);
      }
      /* ุณุชุงูู ูุฑุณุงูุฉ ุงููplaceholder */
      #qr-placeholder {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          min-height: 200px; /* ููุณ ุงุฑุชูุงุน ุงููQR ุจุงุด ูุงูุชุจุฏูุด ุงูุญุฌู ุจุฒุงู */
      }
      #qr-placeholder.hidden {
          display: none;
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white shadow-xl rounded-xl p-6 w-full max-w-md">
      <h1 class="text-3xl font-extrabold mb-6 text-center text-gray-800">๐ณ ุชูููุฏ QR ุงุญุชุฑุงูู</h1>

      <div class="input-group">
        <label for="text">๐ ุงููุต ุฃู ุงูุฑุงุจุท:</label>
        <input id="text" type="text" placeholder="ุฃุฏุฎู ููุง..." />
      </div>

      <div class="input-group">
        <label class="block mb-2 font-semibold">๐จ ุงุฎุชุฑ ุงูููู:</label>
        <div id="color-palette" class="flex gap-3 mb-4 flex-wrap">
          <div class="color-swatch selected" style="background-color: #000000;" data-color="#000000"></div> <div class="color-swatch" style="background-color: #0000FF;" data-color="#0000FF"></div>
          <div class="color-swatch" style="background-color: #FF0000;" data-color="#FF0000"></div>
          <div class="color-swatch" style="background-color: #008000;" data-color="#008000"></div>
          <div class="color-swatch" style="background-color: #800080;" data-color="#800080"></div>
          <div class="color-swatch" style="background-color: #FFA500;" data-color="#FFA500"></div>
        </div>
      </div>
      <div class="input-group">
        <label for="style">๐ ุงูุดูู:</label>
        <select id="style">
          <option value="square">ูุฑุจุนุงุช</option>
          <option value="dots">ููุท</option>
          <option value="rounded">ุฏุงุฆุฑู</option>
        </select>
      </div>

      <div class="input-group">
        <label for="logo">๐ผ๏ธ ุดุนุงุฑ (ุงุฎุชูุงุฑู):</label>
        <input id="logo" type="file" accept="image/*" />
      </div>
      
      <div class="input-group">
        <label for="bottomText">๐ ูุต ุชุญุช ุงููQR (ุงุฎุชูุงุฑู):</label>
        <input id="bottomText" type="text" placeholder="ูุซุงู: VITORHOP" />
      </div>

      <div class="qr-display-area">
        <div id="qr-placeholder">
            <span>ุงููุชูุฌุฉ ุณุชุธูุฑ ููุง</span>
        </div>
        <div id="qr" class="w-[200px] h-[200px] overflow-hidden"></div>
        <div id="text-below-qr" class="qr-text-below"></div>
      </div>

      <div class="button-group">
        <button id="download" class="bg-green-500 text-white hover:bg-green-600">โฌ๏ธ ุชุญููู QR</button>
        <button id="share" class="bg-blue-500 text-white hover:bg-blue-600">๐ค ูุดุงุฑูุฉ QR</button>
      </div>
    </div>

    <script>
      const qrDiv = document.getElementById("qr");
      const qrPlaceholder = document.getElementById("qr-placeholder");
      const textInput = document.getElementById("text");

      const initialText = textInput.value;
      const initialBottomText = document.getElementById("bottomText").value;
      let currentQRColor = "#000000"; // ุงูููู ุงูุงูุชุฑุงุถู (ุฃูู ููู ุบูุจุงู)

      const qrCode = new QRCodeStyling({
        width: 1000,
        height: 1000,
        type: "canvas",
        data: initialText,
        image: "",
        dotsOptions: {
          color: currentQRColor, // ุบูุณุชุนูู ุงูููู ุงูุงูุชุฑุงุถู ุงููู ุฏุฑูุงู
          type: "square",
        },
        backgroundOptions: {
          color: "#FFFF00", // ููู ุฃุตูุฑ ููุฎูููุฉ (ุซุงุจุช)
        },
        imageOptions: {
          crossOrigin: "anonymous",
          margin: 20,
        },
        margin: 30, // ุงููุงูุด ุงูุฃุจูุถ ุญูู ุงููQR Code ููุณู
        cornersSquareOptions: {
          type: 'square', 
          color: currentQRColor,
        },
        cornersDotOptions: {
          type: 'square', 
          color: currentQRColor,
        },
      });

      qrCode.append(qrDiv); // ููุถููู ุงููQR Code ููdiv#qr

      function updateBottomText() {
        document.getElementById("text-below-qr").innerText = document.getElementById("bottomText").value;
      }

      function updateQRCode() {
        const text = textInput.value;
        const shape = document.getElementById("style").value;

        if (text.trim() === "") { // ุฅุฐุง ูุงู ุญูู ุงููุต ูุงุฑุบุงู
          qrPlaceholder.classList.remove("hidden"); // ููุธูุฑู ุงููplaceholder
          qrDiv.classList.remove("active"); // ููุฎููู ุงููQR Code ุงูุญูููู
          document.getElementById("text-below-qr").innerText = ""; // ููุฎููู ุงููุต ุงููู ุชุญุช ุงููQR
        } else { // ุฅุฐุง ูุงู ููู ูุต
          qrPlaceholder.classList.add("hidden"); // ููุฎููู ุงููplaceholder
          qrDiv.classList.add("active"); // ููุธูุฑู ุงููQR Code
          qrCode.update({
            data: text,
            dotsOptions: {
              color: currentQRColor,
              type: shape,
            },
            backgroundOptions: {
               color: "#FFFF00",
            },
            cornersSquareOptions: { 
              color: currentQRColor,
            },
            cornersDotOptions: { 
              color: currentQRColor,
            },
          });
          updateBottomText();
        }
      }

      // ุชุญุฏูุฏ ูุฑุจุน ุงูููู ุงููุฎุชุงุฑ ุญุงููุงู
      function setActiveColorSwatch(selectedColor) {
        document.querySelectorAll('.color-swatch').forEach(swatch => {
          if (swatch.dataset.color === selectedColor) {
            swatch.classList.add('selected');
          } else {
            swatch.classList.remove('selected');
          }
        });
      }

      // ุฅุถุงูุฉ ุงููุณุชูุนูู ููุฃุญุฏุงุซ
      textInput.addEventListener("input", updateQRCode);
      document.getElementById("style").addEventListener("change", updateQRCode);
      document.getElementById("bottomText").addEventListener("input", updateQRCode);

      // ุงููุณุชูุนูู ุงูุฌุฏุฏ ููุฑุจุนุงุช ุงูุฃููุงู
      document.querySelectorAll(".color-swatch").forEach(swatch => {
        swatch.addEventListener("click", function() {
          currentQRColor = this.dataset.color;
          setActiveColorSwatch(currentQRColor);
          updateQRCode();
        });
      });

      document.getElementById("logo").addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (!file) {
            qrCode.update({ image: "" });
            // ุฅูู ุญูุฏูุง ุงูุดุนุงุฑ ููุงูุงููุด ูุตุ ุฑุฌุน ุงููplaceholder
            if (textInput.value.trim() === "") {
                updateQRCode(); // ุจุงุด ูุฑุฌุน ุงููplaceholder
            }
            return;
        }
        const reader = new FileReader();
        reader.onload = function (event) {
          qrCode.update({ image: event.target.result });
          // ููู ููุชุญูู ุงูุดุนุงุฑุ ุชุฃูุฏ ุฃู ุงููQR ุจุงูู
          if (textInput.value.trim() !== "") {
              qrPlaceholder.classList.add("hidden");
              qrDiv.classList.add("active");
          }
        };
        reader.readAsDataURL(file);
      });

      document.getElementById("download").addEventListener("click", () => {
        const qrCanvas = document.querySelector("#qr canvas");
        const bottomTextValue = document.getElementById("bottomText").value;

        // ุชุญุฏูุฏ ุฃุญุฌุงู ุงููQR Code
        const qrWidth = qrCanvas.width;
        const qrHeight = qrCanvas.height;

        // ุฅุนุฏุงุฏุงุช ุงููุต ูู ุงูุฃุณูู
        const fontSize = 70; 
        const font = `bold ${fontSize}px Arial`;
        const textPadding = 40; 
        const bottomMarginForImage = 50; 

        // ุฅุนุฏุงุฏุงุช ุงูุฅุทุงุฑ ุงูุฃุจูุถ
        const strokeWidth = 10; // ุณูู ุงูุฅุทุงุฑ ุงูุฃุจูุถ
        const frameColor = '#FFFFFF'; // ููู ุงูุฅุทุงุฑ ุงูุฃุจูุถ

        // ุญุณุงุจ ุงูุฃุจุนุงุฏ ุงููููุฉ ูููcanvas ุงูุฌุฏูุฏ (ูุน ุงูุฅุทุงุฑ)
        let totalWidth = qrWidth + (strokeWidth * 2);
        let totalHeight = qrHeight + (strokeWidth * 2);

        // ุฅุฐุง ูุงู ููุงู ูุต ูู ุงูุฃุณููุ ูุถูู ุงููุณุงุญุฉ ุฏูุงูู
        if (bottomTextValue.trim()) {
            totalHeight += fontSize + textPadding + bottomMarginForImage;
        }

        const combinedCanvas = document.createElement("canvas");
        const ctx = combinedCanvas.getContext("2d");

        combinedCanvas.width = totalWidth;
        combinedCanvas.height = totalHeight; 

        // 1. ุฑุณู ุงูุฎูููุฉ ุงูุจูุถุงุก ููุฅุทุงุฑ
        ctx.fillStyle = frameColor; 
        ctx.fillRect(0, 0, combinedCanvas.width, combinedCanvas.height);

        // 2. ุฑุณู ุงูุฎูููุฉ ุฏูุงู ุงููQR Code (ุงูุตูุฑุฉ) ุฏุงุฎู ุงูุฅุทุงุฑ
        ctx.fillStyle = '#FFFF00'; // ููู ุงูุฎูููุฉ ุงูุตูุฑุงุก ุฏูุงู ุงููQR Code
        ctx.fillRect(strokeWidth, strokeWidth, qrWidth, qrHeight); // ูุณุงุญุฉ ุงููQR Code ููุท

        // 3. ุฑุณู ุงููQR Code ููุณู (ุงููcanvas ุฏูุงูู) ุฏุงุฎู ุงูุฎูููุฉ ุงูุตูุฑุงุก
        ctx.drawImage(qrCanvas, strokeWidth, strokeWidth);

        // 4. ุฑุณู ุงููุต ูู ุงูุฃุณูู ุฅุฐุง ูุงู ููุฌูุฏุงู
        if (bottomTextValue.trim()) {
            // ูุณุงุญุฉ ุงููุต ุงูุณููู (ุฎูููุฉ ุจูุถุงุก ูููุต)
            ctx.fillStyle = '#FFFFFF'; // ููู ุงูุฎูููุฉ ุงูุจูุถุงุก ูููุต
            ctx.fillRect(strokeWidth, qrHeight + strokeWidth, qrWidth, fontSize + textPadding + bottomMarginForImage);

            ctx.font = font;
            ctx.fillStyle = '#000000'; // ููู ุงููุต ุฃุณูุฏ
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';

            const textX = (qrWidth / 2) + strokeWidth;
            const textY = qrHeight + textPadding + strokeWidth;

            ctx.fillText(bottomTextValue, textX, textY);
        }

        const link = document.createElement('a');
        link.download = 'qr-code-with-frame.png';
        link.href = combinedCanvas.toDataURL('image/png');
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      });

      document.getElementById("share").addEventListener("click", async () => {
        const canvas = document.querySelector("#qr canvas");
        canvas.toBlob(async (blob) => {
          const file = new File([blob], "qr-code.png", { type: "image/png" });
          if (navigator.canShare && navigator.canShare({ files: [file] })) {
            try {
              await navigator.share({ files: [file], title: "QR Code", text: "ูุง ูู ููุฏ QR ุฏูุงูู!" });
            } catch (e) {
              alert("ุชู ุฅูุบุงุก ุงููุดุงุฑูุฉ");
            }
          } else {
            alert("ุงููุดุงุฑูุฉ ุบูุฑ ูุฏุนููุฉ ุนูู ูุฐุง ุงูุฌูุงุฒ.");
          }
        });
      });

      // ูู ุงูุจุฏุงูุฉ: ุชุญุฏูุซ ุงููุงุฌูุฉ ุจูุงุกู ุนูู ุญุงูุฉ ุญูู ุงููุต
      updateBottomText(); // ูุชุญุฏูุซ ุงููุต ูู ุงูุฃุณูู (ุฅู ูุฌุฏ)
      setActiveColorSwatch(currentQRColor); // ูุถุน ุนูุงูุฉ ุนูู ุงูููู ุงูุงูุชุฑุงุถู

      // ููุง ูุชู ูุญุต ุญูู ุงููุต ุนูุฏ ุชุญููู ุงูุตูุญุฉ ูุฃูู ูุฑุฉ
      // ุฅุฐุง ูุงู ูุงุฑุบุงุ ุงููplaceholder ูู ุงููู ููุจุงูุ ูุฅูุง ููุชุจุงู ุงููQR Code
      updateQRCode(); 
    </script>
  </body>
</html>
